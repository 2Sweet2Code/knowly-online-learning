[
    {
      "schemaname": "public",
      "tablename": "course_content",
      "policyname": "Enable read access for course members",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "SELECT",
      "qual": "(EXISTS ( SELECT 1\n   FROM enrollments\n  WHERE ((enrollments.course_id = course_content.course_id) AND (enrollments.user_id = auth.uid()))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "course_content",
      "policyname": "Enable insert for course instructors",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "(EXISTS ( SELECT 1\n   FROM enrollments\n  WHERE ((enrollments.course_id = course_content.course_id) AND (enrollments.user_id = auth.uid()) AND (enrollments.role = 'instructor'::text))))"
    },
    {
      "schemaname": "public",
      "tablename": "course_content",
      "policyname": "Instructors can delete their own content",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "DELETE",
      "qual": "((EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = course_content.course_id) AND (courses.instructor_id = auth.uid())))) AND (created_by = auth.uid()))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "admin_applications",
      "policyname": "Admins have full access to admin applications",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "ALL",
      "qual": "((auth.role() = 'authenticated'::text) AND (EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::text)))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "instructor_applications",
      "policyname": "Admins have full access to instructor applications",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "ALL",
      "qual": "((auth.role() = 'authenticated'::text) AND (EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::text)))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "assignment_submissions",
      "policyname": "Students can view their own submissions",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(auth.uid() = user_id)",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "assignment_submissions",
      "policyname": "Instructors can view all submissions for their courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(EXISTS ( SELECT 1\n   FROM (courses\n     JOIN assignments ON ((assignments.course_id = courses.id)))\n  WHERE ((assignments.id = assignment_submissions.assignment_id) AND (courses.instructor_id = auth.uid()))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "assignment_submissions",
      "policyname": "Students can insert their own submissions",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "(auth.uid() = user_id)"
    },
    {
      "schemaname": "public",
      "tablename": "assignment_submissions",
      "policyname": "Instructors can update submissions for their courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "UPDATE",
      "qual": "(EXISTS ( SELECT 1\n   FROM (courses\n     JOIN assignments ON ((assignments.course_id = courses.id)))\n  WHERE ((assignments.id = assignment_submissions.assignment_id) AND (courses.instructor_id = auth.uid()))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "courses",
      "policyname": "Enable read access for all users",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "true",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "course_announcements",
      "policyname": "Enable read access for all users",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "true",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "course_announcements",
      "policyname": "Enable insert for authenticated users",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "true"
    },
    {
      "schemaname": "public",
      "tablename": "course_announcements",
      "policyname": "Enable update/delete for instructors and admins",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "ALL",
      "qual": "((auth.uid() = created_by) OR (EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = ANY (ARRAY['instructor'::text, 'admin'::text]))))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "courses",
      "policyname": "Instructors can update their courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "UPDATE",
      "qual": "(auth.uid() = instructor_id)",
      "with_check": "(auth.uid() = instructor_id)"
    },
    {
      "schemaname": "public",
      "tablename": "announcement_comments",
      "policyname": "Enable read access for authenticated users",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "SELECT",
      "qual": "true",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "announcement_comments",
      "policyname": "Enable insert for authenticated users",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "true"
    },
    {
      "schemaname": "public",
      "tablename": "announcement_comments",
      "policyname": "Users can update their own comments",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "UPDATE",
      "qual": "(auth.uid() = user_id)",
      "with_check": "(auth.uid() = user_id)"
    },
    {
      "schemaname": "public",
      "tablename": "announcement_comments",
      "policyname": "Users can delete their own comments",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "DELETE",
      "qual": "(auth.uid() = user_id)",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "enrollments",
      "policyname": "Users can view their own enrollments",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "((auth.uid() = user_id) OR (auth.uid() IN ( SELECT course_admins.user_id\n   FROM course_admins\n  WHERE (course_admins.course_id = enrollments.course_id))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "enrollments",
      "policyname": "Users can enroll themselves",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "(auth.uid() = user_id)"
    },
    {
      "schemaname": "public",
      "tablename": "course_comments",
      "policyname": "Students can delete their own comments",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "DELETE",
      "qual": "(user_id = ( SELECT auth.uid() AS uid))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "enrollments",
      "policyname": "Users can update their own enrollments",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "UPDATE",
      "qual": "(auth.uid() = user_id)",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "enrollments",
      "policyname": "Users can delete their own enrollments",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "DELETE",
      "qual": "(auth.uid() = user_id)",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "enrollments",
      "policyname": "Course admins can manage enrollments",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "ALL",
      "qual": "(EXISTS ( SELECT 1\n   FROM course_admins\n  WHERE ((course_admins.course_id = enrollments.course_id) AND (course_admins.user_id = auth.uid()))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Allow trigger to create profiles",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "true"
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Allow users to update own profile",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "UPDATE",
      "qual": "(auth.uid() = id)",
      "with_check": "(auth.uid() = id)"
    },
    {
      "schemaname": "public",
      "tablename": "student_grades",
      "policyname": "Course admins can manage grades",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "ALL",
      "qual": "(EXISTS ( SELECT 1\n   FROM course_admins ca\n  WHERE ((ca.course_id = student_grades.course_id) AND (ca.user_id = ( SELECT auth.uid() AS uid)) AND (ca.status = 'approved'::text))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Allow users to read own profile",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "((auth.uid() = id) OR (auth.role() = 'service_role'::text))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "student_grades",
      "policyname": "Instructors can manage grades for their courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "ALL",
      "qual": "(EXISTS ( SELECT 1\n   FROM courses c\n  WHERE ((c.id = student_grades.course_id) AND (c.instructor_id = ( SELECT auth.uid() AS uid)))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "student_grades",
      "policyname": "Students can view their own grades",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(user_id = ( SELECT auth.uid() AS uid))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "assignments",
      "policyname": "Instructors can view all assignments for their courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = assignments.course_id) AND (courses.instructor_id = auth.uid()))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Enable read access for all users",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "true",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Allow users to insert their own profile",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "(auth.uid() = id)"
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Allow users to update their own profile",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "UPDATE",
      "qual": "(auth.uid() = id)",
      "with_check": "(auth.uid() = id)"
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Allow users to delete their own profile",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "DELETE",
      "qual": "(auth.uid() = id)",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "assignments",
      "policyname": "Instructors can insert assignments for their courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "(EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = assignments.course_id) AND (courses.instructor_id = auth.uid()))))"
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Users can view their own profile",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(auth.uid() = id)",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Users can update their own profile",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "UPDATE",
      "qual": "(auth.uid() = id)",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "assignments",
      "policyname": "Instructors can update their own assignments",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "UPDATE",
      "qual": "(EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = assignments.course_id) AND (courses.instructor_id = auth.uid()))))",
      "with_check": "(EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = assignments.course_id) AND (courses.instructor_id = auth.uid()))))"
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Public profiles are viewable by everyone.",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "true",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "profiles",
      "policyname": "Users can update their own profile.",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "UPDATE",
      "qual": "(auth.uid() = id)",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "assignments",
      "policyname": "Students can view assignments for their enrolled courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(EXISTS ( SELECT 1\n   FROM enrollments\n  WHERE ((enrollments.course_id = assignments.course_id) AND (enrollments.user_id = auth.uid()))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "admin_applications",
      "policyname": "Users can view their own admin applications",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(auth.uid() = user_id)",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "enrollments",
      "policyname": "Users can enroll themselves in courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "(user_id = ( SELECT auth.uid() AS uid))"
    },
    {
      "schemaname": "public",
      "tablename": "admin_applications",
      "policyname": "Users can create admin applications",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "(auth.uid() = user_id)"
    },
    {
      "schemaname": "public",
      "tablename": "admin_applications",
      "policyname": "Instructors can view admin applications for their courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = admin_applications.course_id) AND (courses.instructor_id = auth.uid()))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "assignments",
      "policyname": "Admins can manage all assignments",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "ALL",
      "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::text))))",
      "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::text))))"
    },
    {
      "schemaname": "public",
      "tablename": "admin_applications",
      "policyname": "Instructors can update admin application status",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "UPDATE",
      "qual": "(EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = admin_applications.course_id) AND (courses.instructor_id = auth.uid()))))",
      "with_check": "((status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = admin_applications.course_id) AND (courses.instructor_id = auth.uid())))))"
    },
    {
      "schemaname": "public",
      "tablename": "instructor_applications",
      "policyname": "Users can view their own instructor applications",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(auth.uid() = user_id)",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "instructor_applications",
      "policyname": "Users can create instructor applications",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "(auth.uid() = user_id)"
    },
    {
      "schemaname": "public",
      "tablename": "instructor_applications",
      "policyname": "Instructors can view instructor applications for their courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = instructor_applications.course_id) AND (courses.instructor_id = auth.uid()))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "instructor_applications",
      "policyname": "Instructors can update instructor application status",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "UPDATE",
      "qual": "(EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = instructor_applications.course_id) AND (courses.instructor_id = auth.uid()))))",
      "with_check": "((status = ANY (ARRAY['approved'::text, 'rejected'::text])) AND (EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = instructor_applications.course_id) AND (courses.instructor_id = auth.uid())))))"
    },
    {
      "schemaname": "public",
      "tablename": "assignments",
      "policyname": "Combined assignments view policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "SELECT",
      "qual": "((EXISTS ( SELECT 1\n   FROM courses c\n  WHERE ((c.id = assignments.course_id) AND (c.instructor_id = ( SELECT auth.uid() AS uid))))) OR (EXISTS ( SELECT 1\n   FROM enrollments e\n  WHERE ((e.course_id = assignments.course_id) AND (e.user_id = ( SELECT auth.uid() AS uid))))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "course_admins",
      "policyname": "Combined course_admins delete policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "DELETE",
      "qual": "(((user_id = ( SELECT auth.uid() AS uid)) AND (status = 'pending'::text)) OR (EXISTS ( SELECT 1\n   FROM courses c\n  WHERE ((c.id = course_admins.course_id) AND (c.instructor_id = ( SELECT auth.uid() AS uid))))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "course_admins",
      "policyname": "Combined course_admins insert policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "(EXISTS ( SELECT 1\n   FROM (profiles p\n     JOIN courses c ON ((c.id = course_admins.course_id)))\n  WHERE (((p.id = ( SELECT auth.uid() AS uid)) AND (p.role = 'admin'::text) AND (c.allow_admin_applications = true)) OR (c.instructor_id = ( SELECT auth.uid() AS uid)))))"
    },
    {
      "schemaname": "public",
      "tablename": "course_admins",
      "policyname": "Combined course_admins view policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "SELECT",
      "qual": "((user_id = ( SELECT auth.uid() AS uid)) OR (EXISTS ( SELECT 1\n   FROM courses c\n  WHERE ((c.id = course_admins.course_id) AND (c.instructor_id = ( SELECT auth.uid() AS uid))))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "course_comments",
      "policyname": "Combined comments insert policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "((user_id = ( SELECT auth.uid() AS uid)) AND ((EXISTS ( SELECT 1\n   FROM enrollments e\n  WHERE ((e.course_id = course_comments.course_id) AND (e.user_id = ( SELECT auth.uid() AS uid))))) OR true))"
    },
    {
      "schemaname": "public",
      "tablename": "course_comments",
      "policyname": "Combined comments view policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "SELECT",
      "qual": "(((is_public = true) AND (EXISTS ( SELECT 1\n   FROM enrollments e\n  WHERE ((e.course_id = course_comments.course_id) AND (e.user_id = ( SELECT auth.uid() AS uid)))))) OR (EXISTS ( SELECT 1\n   FROM profiles p\n  WHERE ((p.id = ( SELECT auth.uid() AS uid)) AND ((p.role = 'instructor'::text) OR (p.role = 'admin'::text))))) OR (EXISTS ( SELECT 1\n   FROM courses c\n  WHERE ((c.id = course_comments.course_id) AND (c.instructor_id = ( SELECT auth.uid() AS uid))))) OR ((is_public = true) OR (user_id = ( SELECT auth.uid() AS uid))) OR (user_id = ( SELECT auth.uid() AS uid)))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "course_comments",
      "policyname": "Combined comments update policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "UPDATE",
      "qual": "((EXISTS ( SELECT 1\n   FROM profiles p\n  WHERE ((p.id = ( SELECT auth.uid() AS uid)) AND ((p.role = 'instructor'::text) OR (p.role = 'admin'::text))))) OR (user_id = ( SELECT auth.uid() AS uid)))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "courses",
      "policyname": "Combined courses delete policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "DELETE",
      "qual": "(instructor_id = ( SELECT auth.uid() AS uid))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "courses",
      "policyname": "Combined courses insert policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "(instructor_id = ( SELECT auth.uid() AS uid))"
    },
    {
      "schemaname": "public",
      "tablename": "courses",
      "policyname": "Combined courses view policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "SELECT",
      "qual": "((status = 'active'::text) OR (instructor_id = ( SELECT auth.uid() AS uid)))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "course_content",
      "policyname": "Instructors can view all content for their courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = course_content.course_id) AND (courses.instructor_id = auth.uid()))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "courses",
      "policyname": "Combined courses update policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "UPDATE",
      "qual": "(instructor_id = ( SELECT auth.uid() AS uid))",
      "with_check": "(instructor_id = ( SELECT auth.uid() AS uid))"
    },
    {
      "schemaname": "public",
      "tablename": "enrollments",
      "policyname": "Combined enrollments view policy",
      "permissive": "PERMISSIVE",
      "roles": "{authenticated}",
      "cmd": "SELECT",
      "qual": "((user_id = ( SELECT auth.uid() AS uid)) OR (EXISTS ( SELECT 1\n   FROM (profiles p\n     JOIN courses c ON ((c.id = enrollments.course_id)))\n  WHERE (((p.id = ( SELECT auth.uid() AS uid)) AND (p.role = 'instructor'::text) AND (c.instructor_id = p.id)) OR ((p.id = ( SELECT auth.uid() AS uid)) AND (p.role = 'admin'::text))))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "course_content",
      "policyname": "Instructors can insert content for their courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "INSERT",
      "qual": null,
      "with_check": "((EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = course_content.course_id) AND (courses.instructor_id = auth.uid())))) AND (created_by = auth.uid()))"
    },
    {
      "schemaname": "public",
      "tablename": "course_content",
      "policyname": "Instructors can update their own content",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "UPDATE",
      "qual": "((EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = course_content.course_id) AND (courses.instructor_id = auth.uid())))) AND (created_by = auth.uid()))",
      "with_check": "((EXISTS ( SELECT 1\n   FROM courses\n  WHERE ((courses.id = course_content.course_id) AND (courses.instructor_id = auth.uid())))) AND (created_by = auth.uid()))"
    },
    {
      "schemaname": "public",
      "tablename": "course_content",
      "policyname": "Students can view published content for their enrolled courses",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "SELECT",
      "qual": "(EXISTS ( SELECT 1\n   FROM enrollments\n  WHERE ((enrollments.course_id = course_content.course_id) AND (enrollments.user_id = auth.uid()) AND (course_content.is_published = true))))",
      "with_check": null
    },
    {
      "schemaname": "public",
      "tablename": "course_content",
      "policyname": "Admins can manage all content",
      "permissive": "PERMISSIVE",
      "roles": "{public}",
      "cmd": "ALL",
      "qual": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::text))))",
      "with_check": "(EXISTS ( SELECT 1\n   FROM profiles\n  WHERE ((profiles.id = auth.uid()) AND (profiles.role = 'admin'::text))))"
    }
  ]